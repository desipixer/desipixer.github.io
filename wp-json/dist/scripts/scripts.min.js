var app=angular.module("myApp",[]);app.service("service.auth",function(){var a=function(){var a=Object.freeze({k:"AIzaSyBZvR46qyUilZ6Fl5vn9oPnLZtYHnqSknE"}),b=function(){return a.k};return{getKey:b}}();return{getKey:a.getKey}}),app.service("service.util",["$http","service.auth","$q",function(a,b,c){function d(b,c,e){var g=k(b,c,e);return console.log(g),g?a.get(g).then(function(a){console.log(a.data);var c=a.data;if(c){c.items;if(c.items.forEach(function(a,b){var c=f(a.title),d=n(a.content);d.length>0&&(i=i.concat({title:c,images:d}))}),this.imageCount=i.length,console.log("total Images : ",i.length),!c.hasOwnProperty("nextPageToken"))return console.log("next page exists ? : false"),void j.resolve(i);console.log("Object nextPageToken : "+c.nextPageToken),console.log("next page exists ? : true"),d(b,c.nextPageToken,e)}else console.log("getBlogJSON() >> data is null")},function(a){console.log("getBlogJSON() >> ERROR : "+a)}):console.log("getBlogJSON() >> apiUrl is null "+g),j.promise}function e(a,b){if(!a)return null;b||(b="default-json.json");var c=function(){var a=document.createElement("a");return document.body.appendChild(a),a.style="display: none",function(b,c){var d=JSON.stringify(b),e=new Blob([d],{type:"octet/stream"}),f=window.URL.createObjectURL(e);a.href=f,a.download=c,a.click(),window.URL.revokeObjectURL(f)}}(),d=a,b=b;c(d,b)}function f(a){a=decodeURIComponent(a);var b="",c=a.match(/(\.jpg)|(\.png)/g);return void 0!==c&&null!==c&&(b=c[0]),a=a.replace(/(\.jpg)|(\.png)/g," "),a=a.replace(/\W/g," "),a=a.replace(/\_/g," "),a=a.replace(/\s+/g," ").trim()}var g={defaultBlog:"https://desipixer.blogspot.com"},h=b.getKey(),i=[],j=c.defer();this.imageCount=0;var k=function(a,b,c){var d="https://www.googleapis.com/blogger/v3/blogs/"+a+"/posts?fetchImages=true&key="+h;return a?(b&&(d+="&pageToken="+b),c&&(d+="&maxResults="+c),d):(console.log("getApiUrl() >> siteId is null"),null)},l=function(a){a||(a=g.defaultBlog),a=new URL(a).origin;var b="https://www.googleapis.com/blogger/v3/blogs/byurl?key="+h+"&url="+a;return b},m=function(b){var d=c.defer();b||(b=g.defaultBlog);var e=l(b);return a.get(e).then(function(a){d.resolve(a)}),d.promise},n=function(a){var b=[],c=a.match(/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/g);if(void 0!=c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d].match(/(https?:\/\/.*\.(?:png|jpg))/);if(void 0!=e&&e.length>0){var f=e[0];if(f.indexOf("bp.blogspot.com")){var g=f.split("/")[7];f=f.replace(g,"s1600"),b.push(f)}}}return b};return{getBlogJSON:d,downloadFileAsJson:e,callBlogIdFromUrl:m,imageCount:this.imageCount}}]),app.controller("myCtrl",["$scope","$http","service.util","$q",function(a,b,c,d){a.siteId="719302156971941098",a.siteName="https://desipixer.blogspot.com",a.getSite=function(){if(a.siteId){var b=a.siteId;a.status="Processing...",a.statusColor="blue";var d=c.getBlogJSON(b,null,500);d.then(function(b){if(console.log(b),b){a.siteId+".json"}a.status="Completed",a.statusColor="green"},function(b){a.status="Error",a.statusColor="red",console.log("ERROR >> "+error)})}},a.getSiteName=function(){if(a.siteName){var b=a.siteName,d=c.callBlogIdFromUrl(b);d.then(function(b){b.data&&b.data.id&&(a.siteId=b.data.id)})}else console.log("Error >> site name not defined")}}]);